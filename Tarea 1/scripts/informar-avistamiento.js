let comunas_arica_y_parinacota = [
    "Arica",
    "Camarones",
    "General Lagos",
    "Putre"
]

let comunas_tarapaca = [
    "Alto Hospicio",
    "Camiña",
    "Colchane",
    "Iquique"
]

let comunas_antofagasta = [
    "Antofagasta",
    "Calama",
    "María Elena",
    "Mejillones",
    "Ollagüe",
    "San Pedro de Atacama",
    "Sierra Gorda",
    "Taltal",
    "Tocopilla"
]

let comunas_atacama = [
    "Alto del Carmen",
    "Caldera",
    "Chañaral",
    "Copiapó",
    "Diego de Almagro",
    "Freirina",
    "Huasco",
    "Tierra Amarilla",
    "Vallenar"
]

let comunas_coquimbo = [
    "Andacollo",
    "Canela",
    "Combarbalá",
    "Coquimbo",
    "Illapel",
    "La Higuera",
    "La Serena",
    "Los Vilos",
    "Monte Patria",
    "Ovalle",
    "Paihuano",
    "Punitaqui",
    "Río Hurtado",
    "Salamanca",
    "Vicuña"
]

let comunas_valparaiso = [
    "Calle Larga",
    "Isla de Pascua",
    "Limache",
    "Los Andes",
    "Olmué",
    "Quilpué",
    "Rinconada",
    "San Esteban",
    "Villa Alemana"
]

let comunas_metropolitana = [
    "Alhué",
    "Buin",
    "Calera de Tango",
    "Cerrillos",
    "Cerro Navia",
    "Colina",
    "Conchalí",
    "Curacaví",
    "El Bosque",
    "El Monte",
    "Estación Central",
    "Huechuraba",
    "Independencia",
    "Isla de Maipo",
    "Lampa",
    "La Cisterna",
    "La Granja",
    "La Florida",
    "La Pintana",
    "La Reina",
    "Las Condes",
    "Lo Barnechea",
    "Lo Espejo",
    "Lo Prado",
    "Macul",
    "Maipú",
    "María Pinto",
    "Melipilla",
    "Ñuñoa",
    "Padre Hurtado",
    "Paine",
    "Pedro Aguirre Cerda",
    "Peñaflor",
    "Peñalolén",
    "Pirque",
    "Providencia",
    "Pudahuel",
    "Puente Alto",
    "Quilicura",
    "Quinta Normal",
    "Recoleta",
    "Renca",
    "San Bernardo",
    "San Joaquín",
    "San José de Maipo",
    "San Miguel",
    "San Pedro",
    "San Ramón",
    "Santiago",
    "Talagante",
    "Tiltil",
    "Vitacura"
]

let comunas_ohiggins = [
    "Chépica",
    "Chimbarongo",
    "Codegua",
    "Coinco",
    "Coltauco",
    "Doñihue",
    "Graneros",
    "La Estrella",
    "Las Cabras",
    "Litueche",
    "Lolol",
    "Machalí",
    "Malloa",
    "Marchigüe",
    "Mostazal",
    "Nancagua",
    "Navidad",
    "Palmilla",
    "Paredones",
    "Peralillo",
    "Pichilemu",
    "Placilla",
    "Pumanque",
    "Olivar",
    "Peumo",
    "Pichidegua",
    "Quinta de Tilcoco",
    "Rancagua",
    "Rengo",
    "Requinoa",
    "San Fernando",
    "San Vicente de Tagua Tagua",
    "Santa Cruz"
]

let comunas_maule = [
    "Cauquenes",
    "Chanco",
    "Colbún",
    "Constitución",
    "Curepto",
    "Curicó",
    "Empedrado",
    "Hualañe",
    "Licantén",
    "Linares",
    "Longaví",
    "Maule",
    "Molina",
    "Parral",
    "Pelarco",
    "Pelluhue",
    "Pencahue",
    "Rauco",
    "Retiro",
    "Río Claro",
    "Romeral",
    "Sagrada Familia",
    "San Clemente",
    "San Javier",
    "San Rafael",
    "Talca",
    "Teno",
    "Vichuquén",
    "Villa Alegre",
    "Yerbas Buenas"
]

let comunas_nuble = [
    "Bulnes",
    "Chillán Viejo",
    "Chillán",
    "Cobquecura",
    "Coelemu",
    "Coihueco",
    "El Carmén",
    "Ninhue",
    "Ñiquén",
    "Pemuco",
    "Pinto",
    "Portezuelo",
    "Quillón",
    "Quirihue",
    "Ránquil",
    "San Carlos",
    "San Fabián",
    "San Ignacio",
    "San Nicolás",
    "Trehuaco",
    "Yungay"
]

let comunas_biobio = [
    "Alto Biobío",
    "Antuco",
    "Arauco",
    "Cabrero",
    "Cañete",
    "Contulmo",
    "Curanilahue",
    "Laja",
    "Lebu",
    "Los Álamos",
    "Los Ángeles",
    "Mulchén",
    "Nacimiento",
    "Negrete",
    "Quilaco",
    "Quilleco",
    "San Rosendo",
    "Santa Bárbara",
    "Tirúa",
    "Tucapel",
    "Yumbel"
]

let comunas_araucania = [
    "Angol",
    "Carahue",
    "Cholchol",
    "Collipulli",
    "Cunco",
    "Curacautín",
    "Curarrehue",
    "Ercilla",
    "Freire",
    "Galvarino",
    "Gorbea",
    "Lautaro",
    "Loncoche",
    "Lonquimay",
    "Los Sauces",
    "Lumaco",
    "Melipeuco",
    "Nueva Imperial",
    "Padre Las Casas",
    "Perquenco",
    "Pitrufquén",
    "Pucón",
    "Purén",
    "Puerto Saavedra",
    "Renaico",
    "Temuco",
    "Teodoro Schmidt",
    "Toltén",
    "Traiguén",
    "Victoria",
    "Vilcún",
    "Vilarrica"
]

let comunas_rios = [
    "Corral",
    "Futrono",
    "Lanco",
    "La Unión",
    "Lago Ranco",
    "Los Lagos",
    "Máfil",
    "Mariquina",
    "Paillaco",
    "Panguipulli",
    "Río Bueno",
    "Valdivia"
]

let comunas_lagos = [
    "Ancud",
    "Calbuco",
    "Castro",
    "Chaitén",
    "Chonchi",
    "Cochamó",
    "Curaco de Vélez",
    "Dalcahue",
    "Fresia",
    "Frutillar",
    "Futaleufú",
    "Hualaihué",
    "Llanquihue",
    "Los Muermos",
    "Maullín",
    "Osorno",
    "Palena",
    "Puerto Montt",
    "Puerto Octay",
    "Puerto Varas",
    "Puqueldón",
    "Purranque",
    "Puyehue",
    "Queilén",
    "Quemchi",
    "Quellón",
    "Quinchao",
    "Río Negro",
    "San Juan de la Costa",
    "San Pablo"
]

let comunas_aysen = [
    "Aysén",
    "Chile Chico",
    "Cisnes",
    "Cochrane",
    "Coyhaique",
    "Guaitecas",
    "Lago Verde",
    "O´Higgins",
    "Río Ibáñez",
    "Tortel"
]

let comunas_magallanes = [
    "Antártica",
    "Cabo de Hornos",
    "Laguna Blanca",
    "Natales",
    "Porvenir",
    "Primavera",
    "Punta Arenas",
    "Río Verde",
    "San Gregorio",
    "Timaukel",
    "Torres del Paine"
]

function calcular_comunas() {
    let region = document.formulario.region.selectedIndex;
    let comunas = document.formulario.comuna;

    // Se eliminan comunas pertenecientes a otras regiones
    for (i in comunas) {
        comunas.options.remove(i);
    }

    comunas.options.add(new Option("Elija una opción"));
    // Se muestran comunas según su región
    if (region == 1) {
        for (i in comunas_arica_y_parinacota) {
            comunas.options.add(new Option(comunas_arica_y_parinacota[i]));
        }
    } if (region == 2) {
        for (i in comunas_tarapaca) {
            comunas.options.add(new Option(comunas_tarapaca[i]));
        }
    } if (region == 3) {
        for (i in comunas_antofagasta) {
            comunas.options.add(new Option(comunas_antofagasta[i]));
        }
    } if (region == 4) {
        for (i in comunas_atacama) {
            comunas.options.add(new Option(comunas_atacama[i]));
        }
    } if (region == 5) {
        for (i in comunas_coquimbo) {
            comunas.options.add(new Option(comunas_coquimbo[i]));
        }
    } if (region == 6) {
        for (i in comunas_valparaiso) {
            comunas.options.add(new Option(comunas_valparaiso[i]));
        }
    } if (region == 7) {
        for (i in comunas_metropolitana) {
            comunas.options.add(new Option(comunas_metropolitana[i]));
        }
    } if (region == 8) {
        for (i in comunas_ohiggins) {
            comunas.options.add(new Option(comunas_ohiggins[i]));
        }
    } if (region == 9) {
        for (i in comunas_maule) {
            comunas.options.add(new Option(comunas_maule[i]));
        }
    } if (region == 10) {
        for (i in comunas_nuble) {
            comunas.options.add(new Option(comunas_nuble[i]));
        }
    } if (region == 11) {
        for (i in comunas_biobio) {
            comunas.options.add(new Option(comunas_biobio[i]));
        }
    } if (region == 12) {
        for (i in comunas_araucania) {
            comunas.options.add(new Option(comunas_araucania[i]));
        }
    } if (region == 13) {
        for (i in comunas_rios) {
            comunas.options.add(new Option(comunas_rios[i]));
        }
    } if (region == 14) {
        for (i in comunas_lagos) {
            comunas.options.add(new Option(comunas_lagos[i]));
        }
    } if (region == 15) {
        for (i in comunas_aysen) {
            comunas.options.add(new Option(comunas_aysen[i]));
        }
    } if (region == 16) {
        for (i in comunas_magallanes) {
            comunas.options.add(new Option(comunas_magallanes[i]));
        }
    }
}

let imagenes = 1;
function agregar_imagen() {
    let file = document.getElementsByName("foto-avistamiento")[0];

    // No se puede agregar otra foto si aún no se ha agregado una
    let cantidad = file.files.length;
    if (cantidad == 0) {
        alert("Para agregar otra foto, debes agregar una primero");
        return false;
    }

    // Se aumenta la cantidad de imagenes y se crea el nuevo input
    imagenes++;
    let input = document.getElementsByName("foto-avistamiento")[0];
    let newInput = input.cloneNode();
    let fotos = document.getElementsByName("imagenes")[0];
    let boton = document.getElementsByClassName("boton-agregar")[0];

    // Se setea nuevo id para el nuevo input
    // Se setea un nuevo input sin ningún archivo
    newInput.value = "";
    fotos.appendChild(newInput);

    // Si ya se agregaron 5 fotos, el botón desaparece
    if (imagenes == 5) {
        boton.style.display = "none";
    }
}

let formularios = 1;

function limpiar_select(name) {
    document.getElementsByName(name)[formularios - 1].selectedIndex = 0;
}

function limpiar_input(name) {
    document.getElementsByName(name)[formularios - 1].value = "";
}

function crear_nuevo_formulario() {
    formularios++;

    let form = document.getElementsByName("formulario")[0];
    let newForm = form.cloneNode(true);

    // Se inserta el nuevo formulario al final del otro formulario
    form.insertAdjacentElement("afterend", newForm);

    // Se limpia el nuevo formulario
    limpiar_select("region");
    limpiar_select("comuna");
    limpiar_input("sector");
    limpiar_input("nombre");
    limpiar_input("email");
    limpiar_input("celular");
    limpiar_input("dia-hora-avistamiento");
    limpiar_select("tipo-avistamiento");
    limpiar_select("estado-avistamiento");
    document.getElementsByName("foto-avistamiento")[formularios - 1].value = "";

    //document.write(document.getElementsByName("region")[0].options[0].value);
    //document.getElementsByName("sector")[formularios].value = "";

}

/*------------------------------ VALIDACIONES -------------------------------*/
function validar_region() {
    let i = document.getElementsByName("region")[0].selectedIndex;

    // Se verifica que se haya seleccionado una región
    if (i == 0) {
        alert("Debe elegir una región");
        return false
    } else {
        return true;
    }
}

function validar_comuna() {
    let i = document.getElementsByName("comuna")[0].selectedIndex;

    // Se verifica que se haya seleccionado una comuna
    if (i == 0) {
        alert("Debe elegir una comuna");
        return false;
    } else {
        return true;
    }
}

function validar_sector() {
    let sec = document.getElementsByName("sector")[0].value;
    let secRegex = /^[0-9a-zA-Z\s]+$/;

    // Si no se ingresó sector, está correcto
    if (sec.length == 0) {
        return true;
    }
    // Si el sector supera los 100 caracteres hay un error
    if (sec.length > 100) {
        alert("Nombre del sector demasiado largo");
        return false;
    }

    // Se verifica que el sector solo posea caracteres alfa numéricos
    if (sec.match(secRegex)) {
        return true;
    } else {
        alert("Nombre del sector inválido");
        return false;
    }
}

function validar_nombre() {
    let name = document.getElementsByName("nombre")[0].value;
    let nameRegex = /^[a-zA-Z\s]+$/;

    // Si no se ingresa nombre, hay un error
    if (name.length == 0) {
        alert("Debe ingresar nombre");
        return false;
    }
    // Si el nombre tiene más de 200 caracteres hay un error
    if (name.length > 200) {
        alert("Nombre demasiado largo");
        return false;
    }

    // Se verifica que el nombre solo contenga letras
    if (name.match(nameRegex)) {
        return true;
    } else {
        alert("Nombre inválido");
        return false;
    }
}

function validar_email() {
    let correo = document.getElementsByName("email")[0].value;
    let correoRegex = /^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i;

    // Si no se ingresó correo hay un error
    if (correo.length == 0) {
        alert("Debe ingresar email");
        return false;
    }

    // Si el email tiene más de 100 caracteres hay un error
    if (correo.length > 100) {
        alert("Email demasiado largo");
        return false;
    }
    // Se testea que se cumpla el formato de email
    if (correo.match(correoRegex)) {
        return true;
    } else {
        alert("Email incorrecto, no cumple formato");
        return false;
    }
}

function validar_celular() {
    let cel = document.getElementsByName("celular")[0].value;
    let celRegex = /^[+][0-9]+$/;

    // Si no hay número de celular, se acepta
    if (cel.length == 0) {
        return true;
    }

    // Si el número de celular tiene largo mayor a 15, hay error
    if (cel.length > 15) {
        alert("Número de celular demasiado largo");
        return false;
    }

    // Se testea que se solo hayan números y que el primer carácter sea un +
    if (cel.match(celRegex)) {
        return true;
    } else {
        alert("Número de celular inválido");
        return false;
    }
}

function validar_dia_hora() {
    let fecha = document.getElementsByName("dia-hora-avistamiento")[0].value;
    let fechaRegex = /^\d{2,4}\-\d{1,2}\-\d{1,2}[\s]([01]?[0-9]|2[0-3]):[0-5][0-9]$/;
    
    // Si no se ingresó fecha, hay error
    if (fecha.length == 0) {
        alert("Debe ingresar día y hora");
        return false;
    }
    // Si la fecha ingresada es demasiado larga, hay error
    if (fecha.length > 20) {
        alert("Día y hora ingresados son demasiado largos");
        return false;
    }

    // Se verifica que se cumpla el formato pedido
    if (fecha.match(fechaRegex)) {
        return true;
    } else {
        alert("Día y hora no cumple el formato solicitado");
        return false;
    }
}

function validar_tipo() {
    let i = document.getElementsByName("tipo-avistamiento")[0].selectedIndex;
    // Se verifica que se haya seleccionado una comuna
    if (i == 0) {
        alert("Debe elegir un tipo");
        return false;
    } else {
        return true;
    }
}

function validar_estado() {
    let i = document.getElementsByName("estado-avistamiento")[0].selectedIndex;
    // Se verifica que se haya seleccionado una comuna
    if (i == 0) {
        alert("Debe elegir un estado");
        return false;
    } else {
        return true;
    }
}

function validar_foto() {
    let cantidad = document.getElementsByName("foto-avistamiento")[0].files.length;

    // Si no se ha agregado ninguna foto, hay un error
    if (cantidad == 0) {
        alert("Debe enviar al menos una foto");
        return false;
    } else {
        return true;
    }
}

function validar_extension_imagen() {
    let file = document.getElementsByName("foto-avistamiento")[0].value;
    var extensiones = /(.jpg|.jpeg|.png|.gif)$/i;

    // Se chequea si el archivo ingresado efectivamente es una imagen
    if (!extensiones.exec(file)) {
        alert("El archivo ingresado no corresponde a una imagen");
        file.value = "";
        return false;
    } else {
        return true;
    }
}

function validar() {
    // Se realizan todas las validaciones necesarias
    validar_region();
    validar_comuna();
    validar_sector();
    validar_nombre();
    validar_email();
    validar_celular();
    validar_dia_hora();
    validar_tipo();
    validar_estado();
    validar_foto();
}